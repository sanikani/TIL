# Chapter 07. 스토어드 프로시저

## 07-1 스토어드 프로시저 사용방법

스토어드 프로시저는 SQL에 프로그래밍 기능을 추가해서 일반 프로그래밍 언어와 비슷한 효과를 낼 수 있다.

### 스토어드 프로시저 기본

**스토어드 프로시저의 개념과 형식**

스토어드 프로시저란 MySQL에서 제공하는 프로그래밍 기능이다. 자바, 파이썬 등의 프로그래밍과는 조금 차이가 있지만, MySQL 내부에서 사용할 때 적절한 프로그래밍 기능을 제공해준다.

또한 스토어드 프로시저는 쿼리 문의 집합으로도 볼 수 있으며, 어떠한 동작을 일괄 처리하기 위한 용도로도 사용한다. 자주 사용하는 일반적인 쿼리를 반복하는 것보다는 스토어드 프로시저로 묶어 놓고 필요할 때마다 간단히 호출만 하면 훨씬 편리하게 MySQL을 운영할 수 있다.

다음은 스토어드 프로시저를 만드는 필수적인 형식만 표시한 것이다.

```sql
DELIMITER $$
CREATE PROCEDURE 스토어드_프로시저_이름(IN 또는 OUT 매개변수)
BEGIN
	이 부분에 SQL 프로그래밍 코드를 작성
END $$
DELIMITER;
```

구분자는 필수 항목으로 스토어드 프로시저를 묶어주는 기능을 한다. 1개만 사용해도 되지만 명확하게 표시하기 위해 2개를 사용한다. ##, &&등으로 바꿔도 된다

create procedure는 스토어드 프로시저를 만든 것 뿐이며, 아직 실행한 것은 아니다.

스토어드 프로시저를 호출하는 형식은 다음과 같이 간단하다.

```sql
CALL 스토어드_프로시저_이름();
```

**스토어드 프로시저의 생성**

```sql
use market_db;
drop procedure if exists user_proc;
delimiter $$
create procedure user_proc()
begin
	select * from member;
end $$
delimiter ;

call user_proc();
```

**스토어드 프로시저의 삭제**

앞에서 생성한 user_proc의 내용을 삭제하려면 다음과 같이 drop procedure를 사용할 수 있다.

주의할 점은 create procedure에서는 스토어드 프로시저 이름 뒤에 괄호를 붙이지만, drop procedure에서는 괄호를 붙이지 않아야 한다.

```sql
drop procedure user_proc;
```

### 스토어드 프로시저 실습

**매개변수의 사용**

입력 매개변수를 지정할 수 있다. 입력 매개변수를 지정하는 형식은 다음과 같다

```sql
IN 입력_매개변수_이름 데이터_형식
```

입력 매개변수가 있는 스토어드 프로시저를 실행하기 위해서는 다음과 같이 괄호 안에 값을 전달하면 된다.

```sql
CALL 프로시저_이름(전달_값);
```

처리된 결과를 출력 매개변수를 통해 얻을 수도 있다.

```sql
OUT 출력_매개변수_이름 데이터_형식
```

출력 매개변수에 값을 대입하기 위해서는 주로 SELECT ~ INTO 문을 사용한다.

출력 매개변수가 있는 스토어드 프로시저를 실행하기 위해서는 다음과 같이 사용한다.

```sql
CALL 프로시저_이름(@변수명);
SELECT @변수명;
```

**입력 매개변수의 활용**